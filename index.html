<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Select 3</title>
    <style>
      .all-box {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        font-size: 18px;
        font-family: sans-serif;
        /*width: 350px;*/
        background-color: #fea;
      }
      .create-box {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      .choice {
        background-color: gold;
        border-radius: 5px;
        padding: 2px;
      }
      .output-box {
        border: solid 2px blue;
        padding: 10px;
      }
      .p-out-box {
        padding: 4px;
        background-color: #8ed;
      }
      .sel-elem {
        margin: 0px 4px;
        font-size: 18px;
        text-align: center;
      }
      .para {
        background-color: #ddf;
      }
      .wrong {
        outline: 3px solid #d11;
        border: 2px solid orange;
      }
      .correct {
        outline: 3px solid #151;
        border: 2px solid lime;
      }

      .hide {
        display: none;
      }
    </style>
  </head>
  <body>
    <div id="all-box" class="all-box">
      <div class="create-box hide">
        <h1>Sentences</h1>
        <p id="create-s-0_0">This is sentence 1.</p>
        <p id="create-s-0_1">This is sentence 2.</p>
      </div>
      <div id="output-box" class="output-box">output2</div>
      <button id="btn-check-1">Check</button>
    </div>
    <script>
      //1-- hard code div with paragraphs that have
      // -- sentences, separated with drop downs.
      // -- if the answer is correct on submit, change class - DONE
      //2-- design for cellphone.. prototype
      const sentenceObj = {
        0: {
          parts: {
            0: { type: "text", start: 0, end: 8 },
            1: { type: "sel", start: 8, end: 10 },
            2: { type: "text", start: 10, end: 11 },
            3: { type: "sel", start: 11, end: 16 },
            4: { type: "text", start: 16, end: 24 },
          },
          original: "Welcome to class people.",
        },
        1: {
          parts: {
            0: { type: "sel", start: 0, end: 2 },
            1: { type: "text", start: 2, end: 19 },
          },
          original: "My apologies to you.",
        },
      };

      const allChoices = {
        c_0_0: "to",
        c_0_1: "class",
        c_1_0: "My",
      };

      document.addEventListener("DOMContentLoaded", function (e) {
        renderSentences(sentenceObj, "output-box");
        console.log("Render completed.");
      });

      document
        .querySelector("#btn-check-1")
        .addEventListener("click", function (e) {
          //
          let isMatch = false;

          //2-- loop through all Choices and check if correct...
          let choiceKeys = Object.keys(allChoices);

          for (let i = 0; i < choiceKeys.length; i++) {
            //
            //1-- get value chosen from select.
            let key = choiceKeys[i];
            if (document.querySelector("#" + key) == null) {
              console.warn(
                `key (${document.querySelector(
                  "#" + key
                )}) does not exist. btn-check-1 click event.`
              );
              return;
            }
            let choiceVal = document.querySelector("#" + key).value;

            if (choiceVal == allChoices[key]) {
              isMatch = true;
            } else {
              isMatch = false;
            }
            //3-- if not, add wrong class,
            if (isMatch) {
              //if matches, add correct class
              document.querySelector("#" + key).classList.remove("wrong");
              document.querySelector("#" + key).classList.remove("correct");
              document.querySelector("#" + key).classList.add("correct");
            } else {
              //if not, add wrong class
              document.querySelector("#" + key).classList.remove("correct");
              document.querySelector("#" + key).classList.remove("wrong");
              document.querySelector("#" + key).classList.add("wrong");
            }
            //4-- else, add the correct class
          }
        });

      //FUNCTIONs - function - add sentences with select and option to output box
      function renderSentences(sentenceObj, outputId) {
        //
        let outputElem = document.querySelector("#" + outputId);

        let paraKeys = Object.keys(sentenceObj);
        console.log(sentenceObj);

        for (let i = 0; i < paraKeys.length; i++) {
          let selCount = 0; //this is per line....
          // 1-- create paragraph
          let para = document.createElement("p");
          para.setAttribute("id", "p-" + paraKeys[i]);
          para.classList.add("para");

          // append paragraph to output
          outputElem.appendChild(para);
          // 2 - create text nodes and selects and append them to the
          // paragraph
          let partKeys = Object.keys(sentenceObj[paraKeys[i]]["parts"]);

          for (let j = 0; j < partKeys.length; j++) {
            //
            let type = "text";
            if (
              sentenceObj[paraKeys[i]]["parts"][partKeys[j]]["type"] == "sel"
            ) {
              type = "sel";
            }

            //if type is text, create text node and append
            //else create sel node and append
            let start = sentenceObj[paraKeys[i]]["parts"][partKeys[j]]["start"];
            let end = sentenceObj[paraKeys[i]]["parts"][partKeys[j]]["end"];

            let val = "";
            if (type == "text") {
              val = String(sentenceObj[paraKeys[i]]["original"]).slice(
                start,
                end
              );
              para.appendChild(document.createTextNode(val));
            } else {
              let selElem = document.createElement("select");
              selElem.setAttribute("id", "c_" + i + "_" + selCount);

              //get all values from all Choices object
              let values = Object.values(allChoices);
              console.log(values);
              let randomValues = shuffle(values);
              console.log(randomValues);

              for (let k = 0; k < values.length; k++) {
                let opt1 = document.createElement("option");
                // -- not yet randomized values
                val = values[k];
                opt1.value = val;
                opt1.text = val;
                selElem.add(opt1);
              }

              para.appendChild(selElem);
              selCount++;
            }
          }
        }

        return;
      }

      //FUNCTIONS - shuffle array
      function shuffle(arr) {
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }
    </script>
  </body>
</html>
